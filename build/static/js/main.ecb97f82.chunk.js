(this.webpackJsonpthe_pizza_app=this.webpackJsonpthe_pizza_app||[]).push([[0],{244:function(e,t,a){e.exports=a(454)},249:function(e,t,a){},453:function(e,t,a){},454:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(13),c=a.n(l),o=a(41),i=(a(249),a(25)),u=a(51),s=a(37),m=a(44),d=a.n(m),E=a(460),f=a(55),p=a(467),h=a(463),b=a(466),g=a(465),v=a(457),y=a(458),k=a(216),O=a(462),w=function(e){return{type:"ADD_TO_CART",id:e}},j=v.a.Meta,z=y.a.Title,C={addToCart:w},I=Object(u.b)(null,C)((function(e){var t=e.pizza,a=e.addToCart,r=t.id,l=t.name,c=t.desc,o=t.image,i=t.cost;return n.createElement(v.a,{title:n.createElement(z,{level:4,style:{textAlign:"center"}},l),actions:[n.createElement(z,{level:4},"$",i),n.createElement(f.a,{icon:n.createElement(O.a,null),type:"text",onClick:function(){a(r),k.a.success("".concat(l," added to the cart!"))}}),n.createElement(z,{level:4},"\u20ac",Math.floor(.8*i))],cover:n.createElement("img",{alt:l,src:o})},n.createElement(j,{description:c}))})),T=function(e){var t=e.children;return n.createElement("div",{style:{marginLeft:150,marginRight:150}},t)},S=a(222),x=a.n(S),F=function(){return!!localStorage.getItem("usertoken")},_=function(){var e=localStorage.getItem("usertoken");if(e)return x()(e).identity.email},A=Object(u.b)((function(e){return{count:Object.values(e.cart).reduce((function(e,t){return e+t}),0)}}))((function(e){var t=e.count,a=Object(n.useState)([]),l=Object(s.a)(a,2),c=l[0],i=l[1];Object(n.useEffect)((function(){u()}),[]);var u=function(){d.a.get("/api/pizzas").then((function(e){return e.data})).then((function(e){return i(e)}))};return F(),r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{title:"Let's order some pizza!",extra:[r.a.createElement(o.b,{to:F()?"./profile":"./user"},r.a.createElement(f.a,{key:"account",icon:r.a.createElement(b.a,null),size:"large"})),r.a.createElement(o.b,{to:"./cart"},r.a.createElement(f.a,{key:"cart",icon:r.a.createElement(p.a,{count:t},r.a.createElement(g.a,null)),size:"large"}))]}),r.a.createElement(T,null,r.a.createElement(h.b,{grid:{gutter:32,column:6},dataSource:c,renderItem:function(e){return r.a.createElement(h.b.Item,{key:e.id},r.a.createElement(I,{pizza:e}))}})))})),M=a(142),R=a(455),L=a(459),P=a(461),$=a(226),q=a(464),D=a(468),B=h.b.Item,V=y.a.Title,Y={addToCart:w,removeFromCart:function(e){return{type:"REMOVE_FROM_CART",id:e}},removeAllFromCart:function(e){return{type:"REMOVE_ALL_FROM_CART",id:e}}},W=Object(u.b)(null,Y)((function(e){var t=e.pizza,a=e.addToCart,r=e.removeFromCart,l=e.removeAllFromCart,c=t.id,o=t.name,i=t.desc,u=t.cost,s=t.image,m=t.amount;return n.createElement(B,{actions:[n.createElement(f.a,{icon:n.createElement(q.a,null),onClick:function(){return r(c)}}),n.createElement(V,{level:4},m),n.createElement(f.a,{icon:n.createElement(O.a,null),onClick:function(){return a(c)}}),n.createElement(V,{level:4},"$",m*u," (\u20ac",Math.floor(m*u*.8),")"),n.createElement(f.a,{icon:n.createElement(D.a,null),onClick:function(){return l(c)}})]},n.createElement(B.Meta,{avatar:n.createElement($.a,{size:64,src:s}),title:n.createElement(V,{level:4},o," \u2014 $",u," (\u20ac",Math.floor(.8*u),")"),description:i}))})),J=y.a.Title,K={labelCol:{span:8},wrapperCol:{span:8}},N={required:"${label} is required!"},U=Object(u.b)((function(e){return{pizzas:e.cart}}))((function(e){var t=e.pizzas,a=Object(n.useState)([]),l=Object(s.a)(a,2),c=l[0],i=l[1],u=Object(n.useState)(0),m=Object(s.a)(u,2),v=m[0],y=m[1],k=Object(n.useState)(0),O=Object(s.a)(k,2),w=O[0],j=O[1];Object(n.useEffect)((function(){return z()}),[t]);var z=function(){d.a.get("/api/pizzas").then((function(e){return e.data})).then((function(e){var a=[],n=Object.keys(t).reduce((function(n,r){return a.push(Object(M.a)({},e[r-1],{amount:t[r]})),n+=t[r]*e[r-1].cost}),0);i(a),y(n)}))},C=Object.values(t).reduce((function(e,t){return e+t}),0);return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{title:"Your cart",extra:[r.a.createElement(o.b,{to:F()?"./profile":"./user"},r.a.createElement(f.a,{key:"account",icon:r.a.createElement(b.a,null),size:"large"})),r.a.createElement(f.a,{key:"cart",icon:r.a.createElement(p.a,{count:C},r.a.createElement(g.a,null)),size:"large"})],onBack:function(){return window.history.back()}}),r.a.createElement(T,null,r.a.createElement(R.a,null,"Your order"),0===c.length?r.a.createElement(J,{level:3,style:{textAlign:"center"}},"You need to add something to the cart first!"):r.a.createElement(r.a.Fragment,null,r.a.createElement(h.b,{itemLayout:"horizontal",dataSource:c,renderItem:function(e){return r.a.createElement(W,{key:e.id,pizza:e})}}),r.a.createElement(R.a,null),r.a.createElement(J,{level:4,style:{textAlign:"right"}},"Total: $",v," (\u20ac",Math.floor(.8*v),")"),r.a.createElement(J,{level:4,style:{textAlign:"right"}},"Delivery cost: $5 (\u20ac4)"),r.a.createElement(J,{level:4,style:{textAlign:"right"}},"To be payed: $",v+5," (\u20ac",Math.floor(.8*(v+5)),")"),r.a.createElement(R.a,null,"Shipment details"),w>0?r.a.createElement(r.a.Fragment,null,r.a.createElement(J,{level:3,style:{textAlign:"center"}},"Your order is placed, order number is"," ",w,"!"),r.a.createElement("br",null),r.a.createElement(J,{level:4,style:{textAlign:"center"}},"If you want to be able to access order history, register!")):r.a.createElement(L.a,Object.assign({},K,{onFinish:function(e){var a=e.addressFirstLine,n=e.addressSecondLine,r=e.phone;(function(e){return d.a.post("/api/order",e).then((function(e){return e.data})).catch((function(e){return console.log(e)}))})({email:F()?_():"",pizzas:t,address:a+"\n"+n,phone:r}).then((function(e){return j(e.id)}))},validateMessages:N}),r.a.createElement(L.a.Item,{name:"name",label:"Name"},r.a.createElement(P.a,null)),r.a.createElement(L.a.Item,{name:"phone",label:"Phone number",required:!0,help:'Enter the number without "+7"'},r.a.createElement(P.a,{type:"number",prefix:"+7"})),r.a.createElement(L.a.Item,{name:"addressFirstLine",label:"The first line of address",required:!0},r.a.createElement(P.a,null)),r.a.createElement(L.a.Item,{name:"addressSecondLine",label:"The second line of address",required:!0},r.a.createElement(P.a,null)),r.a.createElement(L.a.Item,{wrapperCol:{offset:8,span:8}},r.a.createElement(f.a,{htmlType:"submit"},"Order!"))))))})),G=y.a.Text,H={labelCol:{span:8},wrapperCol:{span:8}},Q=function(e){var t=e.type,a=Object(n.useState)(""),l=Object(s.a)(a,2),c=l[0],o=l[1];return r.a.createElement(r.a.Fragment,null,"success"===c&&r.a.createElement(i.a,{to:"./profile"}),r.a.createElement(L.a,Object.assign({},H,{onFinish:"login"===t?function(e){var t;o("validating"),(t=e,d.a.post("/api/login",{email:t.email,password:t.password}).then((function(e){return e.data})).then((function(e){return e.ok?localStorage.setItem("usertoken",e.access_token):localStorage.removeItem("usertoken"),e})).catch((function(e){console.log(e)}))).then((function(e){e.ok?o("success"):o("error")}))}:function(e){var t;o("validating"),(t=e,d.a.post("/api/signup",{email:t.email,password:t.password}).then((function(e){return e.data})).then((function(e){return e.ok?localStorage.setItem("usertoken",e.access_token):localStorage.removeItem("usertoken"),e})).catch((function(e){return console.log(e)}))).then((function(e){e.ok?o("success"):o("error")}))}}),r.a.createElement(L.a.Item,{name:"email",required:!0,label:"E-mail",hasFeedback:!0,validateStatus:c},r.a.createElement(P.a,{type:"email"})),r.a.createElement(L.a.Item,{name:"password",required:!0,label:"Password",hasFeedback:!0,validateStatus:c},r.a.createElement(P.a.Password,null)),"signup"===t&&r.a.createElement(L.a.Item,{name:"confirm",rules:[{required:!0,message:"Please confirm your password!"},function(e){var t=e.getFieldValue;return{validator:function(e,a){return a&&t("password")!==a?Promise.reject("The two passwords that you entered do not match!"):Promise.resolve()}}}],label:"Confirm password",dependencies:["password"]},r.a.createElement(P.a.Password,null)),"error"===c&&r.a.createElement(L.a.Item,{wrapperCol:{offset:8,span:8}},r.a.createElement(G,{type:"danger"},"Check the credentials, account is not found :(")),r.a.createElement(L.a.Item,{wrapperCol:{offset:8,span:8}},r.a.createElement(f.a,{htmlType:"submit"},"signup"===t?"Sign up":"Log in"))))},X=function(){var e=Object(n.useState)("login"),t=Object(s.a)(e,2),a=t[0],l=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{title:"Registration",onBack:function(){return window.history.back()}}),r.a.createElement(T,null,r.a.createElement(v.a,{style:{width:"100%"},tabList:[{key:"login",tab:"Log In"},{key:"signup",tab:"Sign Up"}],activeTabKey:a,onTabChange:function(e){return l(e)}},r.a.createElement(Q,{type:a}))))},Z=a(456),ee=a(93),te=function(e){var t=e.children;return r.a.createElement(ee.a,{justify:"space-between",align:"middle"},t)},ae=y.a.Text,ne=y.a.Title,re=function(){var e=Object(n.useState)([]),t=Object(s.a)(e,2),a=t[0],l=t[1],c=Object(n.useState)([]),i=Object(s.a)(c,2),u=i[0],m=i[1],p=[{title:"Date",dataIndex:"datetime",key:"datetime"},{title:"Pizzas",dataIndex:"order_comp",key:"pizzas",render:function(e){return g(e)}},{title:"Address",dataIndex:"address",key:"address"},{title:"Phone",dataIndex:"phone",key:"phone",render:function(e){return"+7"+e}},{title:"Total",dataIndex:"order_comp",key:"total",render:function(e){return v(e)}}];Object(n.useEffect)((function(){b(),h()}),[]);var h=function(){d.a.get("/api/pizzas").then((function(e){return e.data})).then((function(e){return m(e)}))},b=function(){d.a.get("/api/history",{params:{email:_()}}).then((function(e){return e.data.history})).then((function(e){return l(e)}))},g=function(e){var t=[];for(var a in e)t.push(r.a.createElement(r.a.Fragment,null,r.a.createElement(ae,null,e[a]," of ",u[a-1].name),r.a.createElement("br",null)));return t},v=function(e){var t=0;for(var a in e)t+=e[a]*u[a-1].cost;return t+=5,r.a.createElement(ae,null,"$",t," (\u20ac",Math.floor(.8*t),")")};return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{title:"Profile",onBack:function(){return window.history.back()}}),r.a.createElement(T,null,F()?r.a.createElement(r.a.Fragment,null,r.a.createElement(te,null,r.a.createElement(ne,{level:4},"Welcome back, ",_(),"!"),r.a.createElement(o.b,{to:"./"},r.a.createElement(f.a,{onClick:function(){localStorage.removeItem("usertoken")}},"Logout"))),r.a.createElement(R.a,null,"Order history"),a?r.a.createElement(Z.a,{columns:p,dataSource:a}):r.a.createElement(ne,{level:4,style:{textAlign:"center"}},"When you make at least one order, there will be history!")):r.a.createElement(ae,null,"You are not logged in")))},le=(a(453),a(82)),ce=Object(le.b)({cart:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=t.id;switch(t.type){case"ADD_TO_CART":var n=Object(M.a)({},e);return n[a]=(n[a]||0)+1,n;case"REMOVE_FROM_CART":for(var r={},l=0,c=Object.keys(e);l<c.length;l++){var o=c[l];if(o===a){if(!(e[o]>1))continue;r[o]=e[o]-1}else r[o]=e[o]}return r;case"REMOVE_ALL_FROM_CART":for(var i={},u=0,s=Object.keys(e);u<s.length;u++){var m=s[u];m!==a&&(i[m]=e[m])}return i;default:return e}}}),oe=Object(le.c)(ce),ie=function(){return n.createElement(u.a,{store:oe},n.createElement(o.a,null,n.createElement(i.d,null,n.createElement(i.b,{exact:!0,path:"/",component:A}),n.createElement(i.b,{exact:!0,path:"/cart",component:U}),n.createElement(i.b,{exact:!0,path:"/user",component:X}),n.createElement(i.b,{exact:!0,path:"/profile",component:re}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.a,null,r.a.createElement(ie,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[244,1,2]]]);
//# sourceMappingURL=main.ecb97f82.chunk.js.map